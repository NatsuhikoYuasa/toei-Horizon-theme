{%- assign block_settings = block.settings -%}

<div
  id="ProductInformation-{{ section.id }}"
  class="
    product-details
    {% if block_settings.sticky_details_desktop %} sticky-content--desktop{% endif %}
    {% if block_settings.height == 'fill' -%} full-height--desktop{% endif -%}
  "
  style="--details-position: {{ block_settings.details_position }};"
  data-testid="product-information-details"
  {% if settings.transition_to_main_product %}
    data-view-transition-type="product-details"
  {% endif %}
>
  {% capture children %}
    <div class="product-details__stack">
      {%- comment -%}
        ① バッジ（Custom-product-badges）
      {%- endcomment -%}
      <div class="product-details__badges">
        {% render 'Custom-product-badges', product: closest.product %}
      </div>

      {%- comment -%}
        ② テーマエディタで並べたブロック（タイトル・価格・バリアントピッカー・カートボタン・お気に入りなど）
      {%- endcomment -%}
      {% content_for 'blocks' %}

      {%- comment -%}
        ③ 発売日／商品番号／予約情報（バリアントメタフィールド）
           - 発売日: variant.release_date (日付)
           - 予約情報: variant.release_note (1行テキスト)
      {%- endcomment -%}
      {%- liquid
        assign product_resource = closest.product
        assign selected_variant = product_resource.selected_or_first_available_variant

        assign release_date_mf = selected_variant.metafields.variant.release_date
        assign release_note_mf = selected_variant.metafields.variant.release_note
      -%}

      <div class="product-meta">
        {%- if release_date_mf %}
          <div class="product-meta__row product-meta__row--release">
            <span class="product-meta__label">発売日</span>
            <span class="product-meta__value">
              {{ release_date_mf.value | date: '%Y年%-m月%-d日' }}
            </span>
          </div>
        {%- endif %}

        {%- if selected_variant.sku != blank %}
          <div class="product-meta__row product-meta__row--sku">
            <span class="product-meta__label">商品番号</span>
            <span class="product-meta__value">
              {{ selected_variant.sku }}
            </span>
          </div>
        {%- endif %}

        {%- if release_note_mf %}
          <div class="product-meta__row product-meta__row--note">
            <span class="product-meta__label">予約情報</span>
            <span class="product-meta__value">
              {{ release_note_mf.value | newline_to_br }}
            </span>
          </div>
        {%- endif %}
      </div>

            {%- comment -%}
        ④ この商品をシェアする（SNSシェアボックス）
      {%- endcomment -%}
      {%- assign share_url = product_resource.url | prepend: shop.url -%}
      {%- assign instagram_url = settings.social_instagram_link | default: '#' -%}

      <div class="product-share">
        <p class="product-share__heading">この商品をシェアする</p>
        <ul class="product-share__list">
          <li class="product-share__item">
            <a
              href="https://x.com/intent/tweet?url={{ share_url | url_encode }}&text={{ product_resource.title | url_encode }}"
              target="_blank"
              rel="noopener"
              aria-label="Xでシェア"
            >
              <img
                src="//cdn.shopify.com/s/files/1/0754/4078/3603/files/twitter-new-2023-x-logo-white-background-vector_1017-45422.avif?v=1764154462"
                alt="X"
                class="product-share__icon-image"
                loading="lazy"
              >
            </a>
          </li>
          <li class="product-share__item">
            <a
              href="https://www.facebook.com/sharer/sharer.php?u={{ share_url | url_encode }}"
              target="_blank"
              rel="noopener"
              aria-label="Facebookでシェア"
            >
              <img
                src="//cdn.shopify.com/s/files/1/0754/4078/3603/files/facebook-logo-vector-icon-logotype-vector-eps_901408-408.avif?v=1764316253"
                alt="Facebook"
                class="product-share__icon-image"
                loading="lazy"
              >
            </a>
          </li>
          <li class="product-share__item">
            <a
              href="{{ instagram_url }}"
              target="_blank"
              rel="noopener"
              aria-label="Instagramを見る"
            >
              <img
                src="//cdn.shopify.com/s/files/1/0754/4078/3603/files/instagram-vector-logo-icon-social-media-logotype_901408-392.avif?v=1764316254"
                alt="Instagram"
                class="product-share__icon-image"
                loading="lazy"
              >
            </a>
          </li>
          <li class="product-share__item">
            <a
              href="https://social-plugins.line.me/lineit/share?url={{ share_url | url_encode }}"
              target="_blank"
              rel="noopener"
              aria-label="LINEでシェア"
            >
              <img
                src="//cdn.shopify.com/s/files/1/0754/4078/3603/files/art-illustration_1166422-334.avif?v=1764154608"
                alt="LINE"
                class="product-share__icon-image"
                loading="lazy"
              >
            </a>
          </li>
        </ul>
      </div>


      {%- comment -%} 検索キーワードタグ（コレクションのメタフィールド） {%- endcomment -%}
      {% render 'Custom-product-keyword-tags', product: product_resource %}
      
    </div>
  {% endcapture %}

  {% render 'group', children: children, settings: block_settings, shopify_attributes: block.shopify_attributes %}
</div>

{% stylesheet %}
  /* モバイルでの余白調整（デフォルトどおり） */
  @media screen and (max-width: 749px) {
    .product-information.section--page-width .product-details > .group-block {
      padding-inline: 0;
    }
  }

  /* コンテナー */
  .product-details {
    display: flex;
    align-self: start;
    justify-content: center;
  }

  /* 中身を上から縦並びにするラッパー */
  .product-details__stack {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 8px;
  }

  /* バッジ周りの余白 */
  .product-details__badges {
    margin-bottom: 4px;
  }

  /* 発売日／商品番号／予約情報 */
  .product-meta {
    margin-top: 8px;
    margin-bottom: 8px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 1.3rem;
  }

  .product-meta__row {
    display: flex;
    gap: 8px;
  }

  .product-meta__label {
    min-width: 5em;
    color: rgb(var(--color-foreground-rgb) / 0.7);
  }

  .product-meta__value {
    flex: 1;
  }

  /* この商品をシェアする */
  .product-share {
    margin-top: 16px;
    padding: 16px 20px;
    border-radius: 8px;
    background-color: rgb(var(--color-foreground-rgb) / 0.03);
  }

  .product-share__heading {
    margin: 0 0 12px;
    font-size: 1.4rem;
    font-weight: 600;
  }

  .product-share__list {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .product-share__item a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 999px;
    background-color: #ffffff;
    box-shadow: 0 0 0 1px rgb(var(--color-foreground-rgb) / 0.08);
    text-decoration: none;
  }

  .product-share__icon-text {
    font-size: 1.3rem;
    font-weight: 600;
    color: rgb(var(--color-foreground-rgb));
  }

  @media screen and (min-width: 750px) {
    .product-details > .group-block {
      height: min-content;
    }

    .full-height--desktop {
      height: 100%;
      max-height: calc(100vh - var(--header-group-height, 0));
      min-height: fit-content;
    }

    .full-height--desktop .group-block {
      align-self: var(--details-position, 'flex-start');
    }
  }

  .product-keyword-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 16px;
    margin-bottom: 8px;
  }

  .product-keyword-tags__item {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    font-size: .65rem;
    line-height: 1.4;
    border: 1px solid #ff6f6f; /* 必要なら色は後で微調整 */
    background: #fff;
    color: #ff6f6f;
    text-decoration: none;
  }

  .product-keyword-tags__item:hover {
    text-decoration: none;
    background: #ff6f6f;
    color: #fff;
  }

  .product-share__item a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 999px;
    background-color: #ffffff;
    box-shadow: 0 0 0 1px rgb(var(--color-foreground-rgb) / 0.08);
    text-decoration: none;
  }

  .product-share__icon-image {
    width: 20px;
    height: 20px;
    object-fit: contain;
    display: block;
  }


{% endstylesheet %}

{% schema %}
{
  "name": "t:names.details",
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    },
    {
      "type": "text"
    },
    {
      "type": "icon"
    },
    {
      "type": "image"
    },
    {
      "type": "button"
    },
    {
      "type": "video"
    },
    {
      "type": "group"
    },
    {
      "type": "spacer"
    },
    {
      "type": "accordion"
    },
    {
      "type": "product-recommendations"
    },
    {
      "type": "price"
    },
    
    {
      "type": "Custom-product-share"
    },

    {
      "type": "variant-picker"
    },
    {
      "type": "buy-buttons"
    },
    {
      "type": "product-description"
    },
    {
      "type": "review"
    },
    {
      "type": "accelerated-checkout"
    },
    {
      "type": "_divider"
    },
    {
      "type": "product-inventory"
    },
    {
      "type": "product-custom-property"
    }
  ],
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "t:content.size"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:settings.width",
      "options": [
        {
          "value": "fit-content",
          "label": "t:options.fit_content"
        },
        {
          "value": "fill",
          "label": "t:options.fill"
        },
        {
          "value": "custom",
          "label": "t:options.custom"
        }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_width",
      "label": "t:settings.custom_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 100,
      "visible_if": "{{ block.settings.width == 'custom' }}"
    },
    {
      "type": "select",
      "id": "width_mobile",
      "label": "t:settings.width_mobile",
      "options": [
        {
          "value": "fit-content",
          "label": "t:options.fit_content"
        },
        {
          "value": "fill",
          "label": "t:options.fill"
        },
        {
          "value": "custom",
          "label": "t:options.custom"
        }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_width_mobile",
      "label": "t:settings.custom_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 100,
      "visible_if": "{{ block.settings.width_mobile == 'custom' }}"
    },
    {
      "type": "select",
      "id": "height",
      "label": "t:settings.height",
      "options": [
        {
          "value": "fit",
          "label": "t:options.fit_content"
        },
        {
          "value": "fill",
          "label": "t:options.fill"
        }
      ],
      "default": "fit"
    },
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "details_position",
      "label": "t:settings.position",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.top"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.bottom"
        }
      ],
      "default": "flex-start",
      "visible_if": "{{ block.settings.height == \"fill\" }}"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "sticky_details_desktop",
      "label": "t:settings.make_details_sticky_desktop",
      "default": false
    },
    {
      "type": "header",
      "content": "t:content.appearance"
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "t:settings.inherit_color_scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "select",
      "id": "background_media",
      "label": "t:settings.background_media",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "image",
          "label": "t:options.image"
        },
        {
          "value": "video",
          "label": "t:options.video"
        }
      ],
      "default": "none"
    },
    {
      "type": "video",
      "id": "video",
      "label": "t:settings.video",
      "visible_if": "{{ block.settings.background_media == 'video' }}"
    },
    {
      "type": "select",
      "id": "video_position",
      "label": "t:settings.video_position",
      "options": [
        {
          "value": "cover",
          "label": "t:options.cover"
        },
        {
          "value": "contain",
          "label": "t:options.contain"
        }
      ],
      "default": "cover",
      "visible_if": "{{ block.settings.background_media == 'video' }}"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "t:settings.image",
      "visible_if": "{{ block.settings.background_media == 'image' }}"
    },
    {
      "type": "select",
      "id": "background_image_position",
      "label": "t:settings.image_position",
      "options": [
        {
          "value": "cover",
          "label": "t:options.cover"
        },
        {
          "value": "fit",
          "label": "t:options.fit"
        }
      ],
      "default": "cover",
      "visible_if": "{{ block.settings.background_media == 'image' }}"
    },
    {
      "type": "select",
      "id": "border",
      "label": "t:settings.borders",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "solid",
          "label": "t:options.solid"
        }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 10,
      "step": 0.5,
      "unit": "px",
      "label": "t:settings.border_width",
      "default": 1,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:settings.border_opacity",
      "default": 100,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "t:names.details",
      "settings": {
        "width": "custom",
        "custom_width": 100,
        "padding-block-start": 0,
        "padding-block-end": 0,
        "padding-inline-start": 0,
        "padding-inline-end": 0,
        "gap": 12,
        "inherit_color_scheme": true,
        "color_scheme": "",
        "video_position": "cover",
        "background_image_position": "cover",
        "border": "none",
        "border_width": 1,
        "border_opacity": 100
      }
    }
  ]
}
{% endschema %}
