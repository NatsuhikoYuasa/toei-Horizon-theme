{% comment %}
  PICK UP 作品（コレクション一覧）
  - ブロックでコレクションを複数選択
  - 既存「汎用コレクション（Custom）」のUIを流用（サムネ角丸/グリッド/見出し/もっと見るボタン/横スクロール）
  - 価格・商品バッジ等は表示しない
{% endcomment %}

<section
  id="csh-{{ section.id }}"
  class="csh section page-width color-{{ section.settings.color_scheme }}"
  style="
    {% render 'spacing-style', settings: section.settings %}
    --csh-gap-pc: {{ section.settings.gap_pc | default: 16 }}px;
    --csh-gap-sp: {{ section.settings.gap_sp | default: 12 }}px;
    --csh-safe: var(--full-page-grid-margin-inline-offset, var(--page-margin-inline-offset, 16px));
    --csh-accent: {{ section.settings.accent_color | default: '#E63946' }};
    padding-block-start: {{ section.settings['padding-block-start'] | default: 36 }}px;
    padding-block-end:   {{ section.settings['padding-block-end']   | default: 36 }}px;
    {% if section.settings.bg_color != blank %}background: {{ section.settings.bg_color }};{% endif %}
  "
>
  <div class="csh-head">
    {%- liquid
      # 見出しテキスト
      assign heading_text = section.settings.heading
      if heading_text == blank
        assign heading_text = 'PICK UP作品'
      endif

      # もっと見るリンク先（コレクション優先、なければURL）
      assign more_href = ''
      if section.settings.more_link_collection != blank
        assign more_href = section.settings.more_link_collection.url
      elsif section.settings.more_url != blank
        assign more_href = section.settings.more_url
      endif

      # もっと見る文言（未入力なら 見出し＋"をもっと見る"）
      assign more_label = section.settings.more_text
      if more_label == blank
        assign more_label = heading_text | append: 'をもっと見る'
      endif
    -%}

    <h2 class="csh-title">{{ heading_text }}</h2>

    {% comment %} wb03 blocked 不要のためコメントアウト
    {% if more_href != '' %}
      <a class="csh-more" href="{{ more_href }}" aria-label="{{ more_label }}">
        <span class="csh-more-text">{{ more_label }}</span>
        <span class="csh-more-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path d="M8 5l7 7-7 7" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
      </a>
    {% endif %} {% endcomment %}
  </div>

  {% if section.blocks.size > 0 %}
    <div class="csh-grid">
      {% for block in section.blocks %}
        {% assign col = block.settings.collection %}
        {% if col != blank %}
          {% liquid
            assign img = null
            if block.settings.image != blank
              assign img = block.settings.image
            elsif col.image != blank
              assign img = col.image
            elsif col.products_count > 0 and col.products.first.featured_image
              assign img = col.products.first.featured_image
            endif
          %}

          <a class="csh-card" href="{{ col.url }}" {{ block.shopify_attributes }}>
            {% liquid
              assign img = null
              if block.settings.image != blank
                assign img = block.settings.image
              elsif col.image != blank
                assign img = col.image
              elsif col.products_count > 0 and col.products.first.featured_image
                assign img = col.products.first.featured_image
              endif

              assign alt_text = block.settings.title
              if alt_text == blank
                assign alt_text = col.title
              endif
            %}

            <div class="csh-thumb">
              {% if img %}
                {{ img | image_url: width: 700 | image_tag: loading: 'lazy', alt: alt_text }}
              {% else %}
                {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
              {% endif %}
            </div>

            {% if section.settings.show_titles %}
              <div class="csh-body">
                <div class="csh-name">{{ block.settings.title | default: col.title }}</div>
              </div>
            {% endif %}
          </a>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <p class="csh-empty">ブロックでコレクションを追加してください。</p>
  {% endif %}

  <style>
    /* ===== 見出し行 ===== */
    #csh-{{ section.id }} .csh-head{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px; }
    #csh-{{ section.id }} .csh-title{ position:relative; margin:0; font-size:18px; font-weight:700; padding-left:14px; }
    #csh-{{ section.id }} .csh-title::before{ content:""; position:absolute; left:0; top:0; width:3px; height:1.1em; background: var(--csh-accent, #e63946); border-radius:2px; }

    /* “もっと見る” */
    #csh-{{ section.id }} .csh-more{ display:inline-flex; align-items:center; gap:10px; text-decoration:none; color: inherit; font-size:14px; font-weight:600; }
    #csh-{{ section.id }} .csh-more-icon{ display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; min-width:32px; border-radius:999px; background: var(--csh-accent, #e63946); }
    #csh-{{ section.id }} .csh-more-icon svg{ width:18px; height:18px; stroke:#fff; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }

    /* ===== グリッド ===== */
    #csh-{{ section.id }} .csh-grid{ display:grid; grid-template-columns: repeat({{ section.settings.columns_desktop | default: 6 }}, minmax(0,1fr)); gap: var(--csh-gap-pc); }

    /* ===== カード ===== */
    #csh-{{ section.id }} .csh-card{ display:flex; flex-direction:column; color:inherit; text-decoration:none; }

    /* ===== サムネイル ===== */
    #csh-{{ section.id }} .csh-thumb{ border-radius:5px; overflow:hidden;}
    #csh-{{ section.id }} .csh-thumb img{ width:100%; height:auto; display:block; border-radius:5px; }
    #csh-{{ section.id }} .csh-thumb::before{ content:none !important; }
    #csh-{{ section.id }} .placeholder-svg{ width:100%; aspect-ratio: 16/9; display:block; background:#e5e7eb; }

    #csh-{{ section.id }} .csh-body{ padding:8px 12px 10px 0; display:grid; gap:6px; }
    #csh-{{ section.id }} .csh-name{ font-size:13px; line-height:1.4; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }

    /* ===== SP ===== */
    @media (max-width: 768px){
      #csh-{{ section.id }}{ position:relative; }
      #csh-{{ section.id }} .csh-grid{
        display:flex !important; gap: var(--csh-gap-sp);
        overflow-x:auto; overflow-y:visible; -webkit-overflow-scrolling:touch;
        scroll-snap-type:x proximity; scroll-snap-stop:normal; scrollbar-gutter:stable;
        width: calc(100vw - var(--csh-safe));
        margin-right: calc(50% - 50vw - var(--csh-gap-sp));
        padding-bottom: 36px;
      }
      #csh-{{ section.id }} .csh-card{ flex:0 0 clamp(140px, 38vw, 240px); width: clamp(140px, 38vw, 240px); scroll-snap-align:start; }
      #csh-{{ section.id }} .csh-grid::after{ content:""; flex: 0 0 calc(max(0px, var(--csh-safe) - var(--csh-gap-sp))); }
      #csh-{{ section.id }} .csh-more{ position:absolute; right: var(--csh-safe); bottom: 60px; }
    }
  </style>
</section>

{% schema %}
{
  "name": "コレクション一覧（Custom）",
  "settings": [
    { "type": "text", "id": "heading", "label": "見出し", "default": "PICK UP作品" },

    { "type": "header", "content": "もっと見る（リンク先）" },
    { "type": "collection", "id": "more_link_collection", "label": "リンク先コレクション（任意）" },
    { "type": "url", "id": "more_url", "label": "カスタムURL（任意／上の設定より優先度低）" },

    { "type": "header", "content": "もっと見る（文言）" },
    {
      "type": "text",
      "id": "more_text",
      "label": "文言（未入力なら「見出し＋をもっと見る」を自動生成）",
      "default": "人気の作品をもっと見る"
    },

    { "type": "checkbox", "id": "show_titles", "label": "コレクション名を表示", "default": true },

    { "type": "header", "content": "レイアウト" },
    { "type": "range", "id": "columns_desktop", "label": "（PC）列数", "min": 2, "max": 8, "step": 1, "default": 6 },
    { "type": "range", "id": "gap_pc", "label": "（PC）カード間隔(px)", "min": 8, "max": 32, "step": 2, "default": 16 },
    { "type": "range", "id": "gap_sp", "label": "（SP）カード間隔(px)", "min": 6, "max": 24, "step": 1, "default": 12 },

    { "type": "header", "content": "余白 / 背景" },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "上余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "下余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    { "type": "color", "id": "bg_color", "label": "背景色", "default": "#F5F6F9" },

    { "type": "color_scheme", "id": "color_scheme", "label": "配色（Horizonのスキーム）", "default": "scheme-1" },
    { "type": "color", "id": "accent_color", "label": "アクセントカラー（左線／丸アイコン）", "default": "#E63946" }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "コレクション",
      "settings": [
        { "type": "collection", "id": "collection", "label": "コレクションを選択" },
        { "type": "text", "id": "title", "label": "表示名（任意）" },
        { "type": "image_picker", "id": "image", "label": "サムネイル画像を上書き（任意）" }
      ]
    }
  ],
  "max_blocks": 50,
  "presets": [
    {
      "name": "コレクション一覧（Custom）",
      "blocks": [{ "type": "collection" }, { "type": "collection" }, { "type": "collection" }]
    }
  ]
}
{% endschema %}
