{% comment %}
  あなたへのおすすめ（Custom）
  - 初回：fallback_collection を表示
  - 回遊後：localStorage("wb_last_pid") がある場合のみ Product Recommendations API で差し替え
{% endcomment %}

{% liquid
  assign coll = section.settings.fallback_collection
  assign initial_pairs = ''

  assign current_pid = nil
  if product and product.id
    assign current_pid = product.id
  endif
%}

<section
  id="csh-{{ section.id }}"
  class="csh section page-width color-{{ section.settings.color_scheme }}"
  data-limit="{{ section.settings.max_products | default: 8 }}"
  data-intent="{{ section.settings.recommendation_type | default: 'related' }}"
  data-current-pid="{{ current_pid }}" 
  style="
    {% render 'spacing-style', settings: section.settings %}
    --csh-gap-pc: {{ section.settings.gap_pc | default: 16 }}px;
    --csh-gap-sp: {{ section.settings.gap_sp | default: 12 }}px;
    --csh-safe: var(--full-page-grid-margin-inline-offset, var(--page-margin-inline-offset, 16px));
    --csh-accent: {{ section.settings.accent_color | default: '#E63946' }};
    padding-block-start: {{ section.settings['padding-block-start'] | default: 36 }}px;
    padding-block-end:   {{ section.settings['padding-block-end']   | default: 36 }}px;
    {% if section.settings.bg_color != blank %}background: {{ section.settings.bg_color }};{% endif %}
  "
>
  {% if coll %}
    <div class="csh-head">
      <h2 class="csh-title">
        {%- if coll.title != blank -%}
          {{ coll.title }}
        {%- else -%}
          おすすめ商品
        {%- endif -%}
      </h2>
    </div>

    {% if coll.products_count > 0 %}
      <div class="csh-grid js-home-recos-grid">
        {% assign shown_count = 0 %}
        {% for product in coll.products %}
          {% if shown_count >= section.settings.max_products %}
            {% break %}
          {% endif %}

          {%- comment -%}
            display_start_at / display_end_at による表示ロック判定
          {%- endcomment -%}
          {% liquid
            assign display_locked = false
            assign display_start_raw = product.metafields.product.display_start_at
            assign display_end_raw = product.metafields.product.display_end_at

            if display_start_raw != blank or display_end_raw != blank
              assign now_ts = 'now' | date: '%s'

              if display_start_raw != blank
                assign start_ts = display_start_raw | date: '%s'
              endif

              if display_end_raw != blank
                assign end_ts = display_end_raw | date: '%s'
              endif

              if display_start_raw != blank and display_end_raw == blank
                # start のみ → その日時より前は NG
                if now_ts < start_ts
                  assign display_locked = true
                endif

              elsif display_start_raw == blank and display_end_raw != blank
                # end のみ → その日時より後は NG
                if now_ts > end_ts
                  assign display_locked = true
                endif

              elsif display_start_raw != blank and display_end_raw != blank
                # start & end → 期間外は NG（期間内のみ表示）
                if now_ts < start_ts or now_ts > end_ts
                  assign display_locked = true
                endif
              endif
            endif
          %}

          {%- comment -%}
            ▼ バッジ判定（商品ページ・最近見た商品と同じシンプル版）
          {%- endcomment -%}
          {%- liquid
            assign is_new          = false
            assign pre_ok          = false
            assign first_bonus_low = false
            assign early_bonus     = false
            assign closing_soon    = false

            if product != blank and product.id != blank
              assign now_ts = 'now' | date: '%s' | plus: 0

              ##### --- NEW（display_start_at から60日以内） ---
              assign sixty_days = 60 | times: 86400
              assign cutoff_ts = now_ts | minus: sixty_days

              assign ds = product.metafields.product.display_start_at
              if ds != blank
                assign ds_ts = ds | date: '%s'
                if ds_ts >= cutoff_ts and ds_ts <= now_ts
                  assign is_new = true
                endif
              endif

              ##### --- 予約 / 初回特典 / 早期特典 / 締切間近 ---
              assign min_end_ts = 0

              for v in product.variants
                # 予約商品か
                if v.metafields.variant.is_preorder.value
                  assign pre_ok = true
                endif

                # 初回特典あり（在庫は見ない）
                if v.metafields.custom.is_first_bonus.value
                  assign first_bonus_low = true
                endif

                # 早期予約特典あり
                if v.metafields.custom.is_early_bonus.value
                  assign early_bonus = true
                endif

                # 締切間近用：sell_end_at の最短
                assign v_end_raw = v.metafields.variant.sell_end_at
                if v_end_raw != blank
                  assign v_end_ts = v_end_raw | date: '%s' | plus: 0
                  if min_end_ts == 0 or v_end_ts < min_end_ts
                    assign min_end_ts = v_end_ts
                  endif
                endif
              endfor

              if min_end_ts != 0
                assign ten_days_sec    = 10 | times: 86400
                assign closing_from_ts = min_end_ts | minus: ten_days_sec
                if now_ts >= closing_from_ts and now_ts <= min_end_ts
                  assign closing_soon = true
                endif
              endif
            endif
          -%}

          {%- comment -%}
            ▼ JS 用の初期データ（handle ごとのマップに入れる）
          {%- endcomment -%}
          {% capture pair %}
            {{ product.handle | json }}: {
              "display_locked": {{ display_locked | json }},
              "display_start_at": {{ product.metafields.product.display_start_at | json }},
              "is_new": {{ is_new | json }},
              "pre_ok": {{ pre_ok | json }},
              "first_bonus_low": {{ first_bonus_low | json }},
              "early_bonus": {{ early_bonus | json }},
              "closing_soon": {{ closing_soon | json }}
            }
          {% endcapture %}

          {% if forloop.first %}
            {% assign initial_pairs = pair %}
          {% else %}
            {% assign initial_pairs = initial_pairs | append: ',' | append: pair %}
          {% endif %}

          {%- comment -%} ★ロック商品はデータだけ残して表示はスキップ {%- endcomment -%}
          {% if display_locked %}
            {% continue %}
          {% endif %}

          {%- comment -%}
            ▼ 実際に表示するカードは max_products 件まで
          {%- endcomment -%}
          <a
            class="csh-card{% if display_locked %} csh-card--locked{% endif %}"
            href="{{ product.url | within: coll }}"
          >
            <div class="csh-thumb">
              {% if product.featured_image %}
                {{ product.featured_image | image_url: width: 700 | image_tag: loading: 'lazy', alt: product.title }}
              {% endif %}
            </div>

            {% if section.settings.show_badges %}
              <div class="csh-badges csh-badges--below">
                {% render 'Custom-product-badges', badge_product: product, badge_class: 'csh-badge' %}
              </div>
            {% endif %}

            <div class="csh-body">
              <div class="csh-name">{{ product.title }}</div>
              {% if section.settings.show_price %}
                <div class="csh-price">
                  {%- assign has_sale = false -%}
                  {%- if product.compare_at_price_max > product.price -%}
                    {%- assign has_sale = true -%}
                  {%- endif -%}

                  {%- if has_sale -%}
                    <span class="csh-price-current">{{ product.price | money }}</span>
                    <span class="csh-price-compare"><s>{{ product.compare_at_price_max | money }}</s></span>
                  {%- else -%}
                    <span class="csh-price-current">
                      {%- if product.price_varies -%}
                        {{ product.price_min | money }} — {{ product.price_max | money }}
                      {%- else -%}
                        {{ product.price | money }}
                      {%- endif -%}
                    </span>
                  {%- endif -%}
                  <span class="csh-price-tax">（税込）</span>
                </div>
              {% endif %}
            </div>
          </a>

          {% assign shown_count = shown_count | plus: 1 %}

        {% endfor %}
      </div>
    {% else %}
      <p class="csh-empty">このコレクションに商品がありません。</p>
    {% endif %}
  {% else %}
    <p class="csh-empty">セクション設定でコレクションを選択してください。</p>
  {% endif %}

  {% capture initial_ex_json %}
    { {% if initial_pairs != blank %}{{ initial_pairs }}{% endif %} }
  {% endcapture %}

  <style>
    /* ===== 見出し行（このセクション固有） ===== */
    #csh-{{ section.id }} .csh-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:40px;
    }
    #csh-{{ section.id }} .csh-title{
      position:relative;
      margin:0;
      font-size:18px;
      font-weight:700;
      padding-left:14px;
    }
    #csh-{{ section.id }} .csh-title::before{
      content:"";
      position:absolute;
      left:0;
      top:0;
      width:3px;
      height:1.1em;
      background: var(--csh-accent, #e63946);
      border-radius:2px;
    }

    /* ===== PC グリッドレイアウト ===== */
    #csh-{{ section.id }} .csh-grid{
      display:grid;
      grid-template-columns: repeat({{ section.settings.columns_desktop | default: 6 }}, minmax(0,1fr));
      gap: var(--csh-gap-pc);
    }

    /* ===== SP：横スクロール ===== */
    @media (max-width:768px){
      #csh-{{ section.id }}{
        position:relative;
      }
      #csh-{{ section.id }} .csh-grid{
        display:flex !important;
        gap: var(--csh-gap-sp);
        overflow-x:auto;
        overflow-y:visible;
        -webkit-overflow-scrolling:touch;
        scroll-snap-type:x proximity;
        scroll-snap-stop:normal;
        scrollbar-gutter:stable;
        width: calc(100vw - var(--csh-safe));
        margin-right: calc(50% - 50vw - var(--csh-gap-sp));
        padding-bottom: 0;
      }
      #csh-{{ section.id }} .csh-card{
        flex:0 0 clamp(140px, 38vw, 240px);
        width: clamp(140px, 38vw, 240px);
        scroll-snap-align:start;
      }
      #csh-{{ section.id }} .csh-grid::after{
        content:"";
        flex: 0 0 calc(max(0px, var(--csh-safe) - var(--csh-gap-sp)));
      }
    }

    /* display_start_at / display_end_at でロックされたカード（半透明＋クリック不可） */
    #csh-{{ section.id }} .csh-card.csh-card--locked{
      opacity:0.4;
      pointer-events:none;
      cursor:default;
    }
  </style>

  <script>
    (function(){
      console.log('[home recos] init');

      var sec  = document.getElementById('csh-{{ section.id }}');
      if (!sec) {
        console.warn('[home recos] section not found');
        return;
      }
      var grid = sec.querySelector('.js-home-recos-grid');
      if (!grid) {
        console.warn('[home recos] grid not found');
        return;
      }

      var LIMIT      = Number(sec.dataset.limit || {{ section.settings.max_products | default: 8 }});
      var INTENT     = (sec.dataset.intent || '{{ section.settings.recommendation_type | default: "related" }}');
      var SHOW_PRICE = {{ section.settings.show_price | json }};
      var moneyFormat = {{ shop.money_format | json }};

      var initialEx = {{ initial_ex_json }} || {};

      function formatMoney(cents){
        if (!SHOW_PRICE) return '';
        if (window.Shopify && Shopify.formatMoney){
          return Shopify.formatMoney(cents, moneyFormat);
        }
        try{
          return (cents / 100).toLocaleString('ja-JP', {
            style:'currency',
            currency:'JPY',
            minimumFractionDigits:0,
            maximumFractionDigits:0
          });
        }catch(e){
          return '¥' + Math.round(cents / 100);
        }
      }

      function toCents(x){
        if (x == null) return null;
        if (typeof x === 'number' && isFinite(x)) return Math.round(x);
        if (typeof x === 'string'){
          var s = x.replace(/[^\d.]/g, '').trim();
          if (!s) return null;
          var f = parseFloat(s);
          return isFinite(f) ? Math.round(f * 100) : null;
        }
        return null;
      }

      function productHref(p){
        var base = {{ routes.root_url | json }};
        if (p && p.url) return p.url;
        if (p && p.online_store_url) return p.online_store_url;
        if (p && p.handle) return base + 'products/' + p.handle;
        return '#';
      }

      function primaryImage(p){
        if (p && p.featured_image) return p.featured_image;
        if (p && p.images && p.images[0]){
          return p.images[0].src || p.images[0].url || null;
        }
        return null;
      }

      /* recentlyViewedEx から display_locked 等を拾う */
      var exMap = {};
      try{
        var exArr = JSON.parse(localStorage.getItem('recentlyViewedEx')) || [];
        if (Array.isArray(exArr)){
          for (var i = 0; i < exArr.length; i++){
            var item = exArr[i];
            if (!item || !item.handle) continue;
            exMap[item.handle] = item;
          }
        }
      }catch(e){
        console.warn('[home recos] exMap error', e);
      }

      function normalize(p){
        var handle = p.handle || null;

        // Liquid 初期データ（initialEx）＋ recentlyViewedEx の情報をマージ
        var init          = (handle && initialEx[handle]) ? initialEx[handle] : {};
        var exFromStorage = (handle && exMap[handle])     ? exMap[handle]     : {};
        var ex            = {};
        for (var k in init){ ex[k] = init[k]; }
        for (var k2 in exFromStorage){ ex[k2] = exFromStorage[k2]; }

        // 初回特典フラグ：first_bonus_low があればそれを優先
        var firstBonusFlag;
        if (typeof ex.first_bonus_low !== 'undefined'){
          firstBonusFlag = !!ex.first_bonus_low;
        } else {
          firstBonusFlag = !!(ex.first_bonus_total && Number(ex.first_bonus_total) > 0);
        }

        return {
          id: p.id,
          title: p.title,
          handle: handle,
          url: p.url || p.online_store_url || null,
          featured_image: primaryImage(p),
          price: p.price,
          price_min: p.price_min,
          price_max: p.price_max,
          price_varies: p.price_varies,
          compare_at_price_max: p.compare_at_price_max,
          variants: p.variants || null,

          display_locked: !!(p.display_locked || ex.display_locked),

          // display_start_at は Liquid / recentlyViewedEx のどちらかにあれば拾う
          display_start_at: ex.display_start_at || p.display_start_at || null,

          // バッジフラグ
          is_new: !!ex.is_new,
          pre_ok: !!ex.pre_ok,
          first_bonus_low: firstBonusFlag,
          early_bonus: !!ex.early_bonus,
          closing_soon: !!ex.closing_soon
        };
      }

      function keyOf(p){
        return p.id || p.handle || p.url || (p.title + ':' + (p.price || ''));
      }

      function dedupe(list){
        var s = {};
        var out = [];
        for (var i = 0; i < list.length; i++){
          var p = list[i];
          var k = keyOf(p);
          if (s[k]) continue;
          s[k] = true;
          out.push(p);
        }
        return out;
      }

      function render(list){
        console.log('[home recos] render', list.length);
        var html = '';
        var max = Math.min(list.length, LIMIT);

        for (var i = 0; i < max; i++){
          var p = list[i];
          var img       = primaryImage(p);
          var priceHtml = priceHTMLFromProduct(p);
          var locked    = !!p.display_locked;
          var href      = locked ? 'javascript:void(0)' : productHref(p);
          var lockedCls = locked ? ' csh-card--locked' : '';
          var lockedAttr= locked ? ' aria-disabled="true"' : '';

          // NEW 判定（display_start_at から60日以内）
          var is_new = false;
          try {
            var ds = p.display_start_at;
            if (ds) {
              var dsTs   = Date.parse(ds);
              var nowTs  = Date.now();
              var cutoff = nowTs - 60 * 86400000; // 60日

              if (!isNaN(dsTs) && dsTs >= cutoff && dsTs <= nowTs) {
                is_new = true;
              }
            }
          } catch(e) {}

          if (!is_new && p.is_new) {
            is_new = !!p.is_new;
          }

          var pre_ok    = !!p.pre_ok;
          var early     = !!p.early_bonus;
          var closing   = !!p.closing_soon;
          var first_low = !!p.first_bonus_low;

          var badges = '';
          if (is_new || pre_ok || early || first_low || closing){
            badges += '<div class="csh-badges csh-badges--below">';

            if (is_new){
              badges += '<span class="csh-badge csh-badge--new">NEW</span>';
            }
            if (pre_ok){
              badges += '<span class="csh-badge csh-badge--pre">予約受付中</span>';
            }
            if (early){
              badges += '<span class="csh-badge csh-badge--early">早期予約特典あり</span>';
            }
            if (first_low){
              badges += '<span class="csh-badge csh-badge--first">初回特典残りわずか</span>';
            }
            if (closing){
              badges += '<span class="csh-badge csh-badge--closing">締切間近</span>';
            }

            badges += '</div>';
          }

          html += '<a class="csh-card' + lockedCls + '" href="' + href + '"' + lockedAttr + '>';
          html +=   '<div class="csh-thumb">';
          if (img){
            html += '<img src="' + img + '&width=700" alt="' + (p.title || '') + '" loading="lazy">';
          }
          html +=   '</div>';
          html +=   badges;
          html +=   '<div class="csh-body">';
          html +=     '<div class="csh-name">' + (p.title || '') + '</div>';
          if (priceHtml){
            html +=   '<div class="csh-price">' + priceHtml + '</div>';
          }
          html +=   '</div>';
          html += '</a>';
        }
        grid.innerHTML = html;
      }

      function priceHTMLFromProduct(p){
        if (!SHOW_PRICE) return '';

        var priceMinC = toCents(
          p.price_min != null ? p.price_min :
          (p.price != null ? p.price :
           (p.variants && p.variants[0] && p.variants[0].price))
        );
        var priceMaxC   = toCents(p.price_max);
        var compareMaxC = toCents(p.compare_at_price_max);

        var hasSale = (compareMaxC != null && priceMinC != null && compareMaxC > priceMinC);
        var taxHtml = '<span class="csh-price-tax">（税込）</span>';

        if (hasSale){
          var currentHtml = formatMoney(priceMinC);
          var compareHtml = formatMoney(compareMaxC);
          return (
            '<span class="csh-price-current">' + currentHtml + '</span>' +
            '<span class="csh-price-compare"><s>' + compareHtml + '</s></span>' +
            taxHtml
          );
        }

        var priceText;
        if (p.price_varies && priceMinC != null && priceMaxC != null && priceMaxC !== priceMinC){
          priceText = formatMoney(priceMinC) + ' — ' + formatMoney(priceMaxC);
        } else if (priceMinC != null){
          priceText = formatMoney(priceMinC);
        } else {
          return '';
        }

        return '<span class="csh-price-current">' + priceText + '</span>' + taxHtml;
      }

      async function fetchRecommendations(pid){
        var url = "{{ routes.product_recommendations_url }}.json"
                  + "?product_id=" + encodeURIComponent(pid)
                  + "&intent=" + encodeURIComponent(INTENT)
                  + "&limit=" + encodeURIComponent(LIMIT);
        var r = await fetch(url, {credentials:'same-origin'});
        if (!r.ok) throw new Error('recos failed');
        var data = await r.json();
        console.log('[home recos] recos raw', data);
        var list = Array.isArray(data.products) ? data.products : [];
        var out = [];
        for (var i = 0; i < list.length; i++){
          out.push(normalize(list[i]));
        }
        return out;
      }

      async function fetchCollection(handle, take){
        if (!handle) return [];
        var r = await fetch('/collections/' + encodeURIComponent(handle) + '/products.json?limit=' + encodeURIComponent(take), {credentials:'same-origin'});
        if (!r.ok) throw new Error('collection failed');
        var json = await r.json();
        var products = json.products || [];
        var out = [];
        for (var i = 0; i < products.length; i++){
          out.push(normalize(products[i]));
        }
        return out;
      }

      async function renderFallback(){
        var fallbackHandle = {{ coll.handle | json }};
        if (!fallbackHandle){
          console.warn('[home recos] no fallback handle');
          return;
        }
        console.log('[home recos] renderFallback from collection', fallbackHandle);
        var fallback = await fetchCollection(fallbackHandle, LIMIT);
        fallback = dedupe(fallback);
        var filtered = [];
        for (var i = 0; i < fallback.length; i++){
          if (!fallback[i].display_locked) filtered.push(fallback[i]);
        }
        render(filtered);
      }

        async function run(){
        var lastPid = null;

        // 1. localStorage から取得
        try{
          lastPid = localStorage.getItem('wb_last_pid');
        }catch(e){
          console.warn('[home recos] wb_last_pid read error', e);
        }

        // 2. 無ければ data-current-pid からセット
        if (!lastPid){
          var currentPidAttr = sec.getAttribute('data-current-pid');
          if (currentPidAttr){
            lastPid = String(currentPidAttr);
            try {
              localStorage.setItem('wb_last_pid', lastPid);
            } catch(e) {
              console.warn('[home recos] wb_last_pid write error', e);
            }
          }
        }

        console.log('[home recos] lastPid =', lastPid);

        if (!lastPid){
          console.log('[home recos] no pid → 初回コレクションのまま');
          return;
        }

        try{
          // ① レコメンド取得
          var recos = await fetchRecommendations(lastPid);
          recos = dedupe(recos);

          // display_locked 除外
          var filtered = [];
          for (var i = 0; i < recos.length; i++){
            if (!recos[i].display_locked) filtered.push(recos[i]);
          }

          // 見出しはここで必ず差し替え
          var titleEl = sec.querySelector('.csh-title');
          if (titleEl){
            titleEl.textContent = {{ section.settings.title_personal | json }};
          }

          // 最終的にレンダリングに使うリスト
          var list = filtered;

          // ② レコメンドが 0 件 → まるごと fallback
          if (!list.length){
            console.log('[home recos] 0件 → fallback レンダリング');
            await renderFallback();
            return;
          }

          // ③ 件数が LIMIT 未満なら、fallback コレクションで穴埋め
          if (list.length < LIMIT){
            var fallbackHandle = {{ coll.handle | json }};
            if (fallbackHandle){
              try{
                var fallback = await fetchCollection(fallbackHandle, LIMIT);
                fallback = dedupe(fallback);

                // ロック商品を除外
                var fallbackFiltered = [];
                for (var j = 0; j < fallback.length; j++){
                  if (!fallback[j].display_locked) fallbackFiltered.push(fallback[j]);
                }

                // 既存リスト + fallback をマージして重複除去
                list = dedupe(list.concat(fallbackFiltered));
              }catch(err){
                console.warn('[home recos] fallback merge error', err);
              }
            }
          }

          // ④ 最終リストを描画（render 内で LIMIT までに絞られる）
          render(list);
          return;

        } catch(e){
          console.warn('[home recos] error in run()', e);
          await renderFallback();
          return;
        }
      }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', function(){ run(); }, {once:true});
      } else {
        run();
      }
    })();
  </script>

</section>

{% schema %}
{
  "name": "あなたへのおすすめ（Custom）",
  "settings": [
    {
      "type": "text",
      "id": "title_personal",
      "label": "回遊後の見出し（差し替え時）",
      "default": "あなたへのおすすめ"
    },

    {
      "type": "collection",
      "id": "fallback_collection",
      "label": "初回に表示するおすすめコレクション",
      "info": "初回訪問時に表示する商品コレクション。"
    },

    {
      "type": "select",
      "id": "recommendation_type",
      "label": "おすすめ種別（回遊後）",
      "options": [
        { "value": "related", "label": "関連商品" },
        { "value": "complementary", "label": "一緒に購入されやすい" }
      ],
      "default": "related"
    },

    { "type": "range", "id": "max_products", "label": "最大表示数", "min": 3, "max": 12, "step": 1, "default": 8 },
    { "type": "checkbox", "id": "show_price", "label": "価格を表示", "default": true },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "商品ラベル（初回表示時のみ Liquid 側で制御）",
      "default": true
    },
    { "type": "header", "content": "レイアウト" },
    { "type": "range", "id": "columns_desktop", "label": "（PC）列数", "min": 2, "max": 8, "step": 1, "default": 6 },
    { "type": "range", "id": "gap_pc", "label": "（PC）カード間隔(px)", "min": 8, "max": 32, "step": 2, "default": 16 },
    { "type": "range", "id": "gap_sp", "label": "（SP）カード間隔(px)", "min": 6, "max": 24, "step": 1, "default": 12 },

    { "type": "header", "content": "余白 / 背景" },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "上余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "下余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    { "type": "color", "id": "bg_color", "label": "背景色", "default": "#F5F6F9" },

    { "type": "color_scheme", "id": "color_scheme", "label": "配色（Horizonのスキーム）", "default": "scheme-1" },
    { "type": "color", "id": "accent_color", "label": "アクセントカラー（左線／丸アイコン）", "default": "#E63946" }
  ],
  "presets": [{ "name": "あなたへのおすすめ（Custom）" }]
}
{% endschema %}
