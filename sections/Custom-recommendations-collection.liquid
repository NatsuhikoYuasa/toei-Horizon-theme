{% comment %}
  あなたへのおすすめ（Custom）
  - 初回：fallback_collection を「汎用コレクション（Custom）」と同じロジックで表示
  - 回遊後：localStorage("wb_last_pid") がある場合のみ Product Recommendations API で差し替え
{% endcomment %}

{% liquid
  assign coll = section.settings.fallback_collection
  assign initial_pairs = ''
%}

<section
  id="csh-{{ section.id }}"
  class="csh section page-width color-{{ section.settings.color_scheme }}"
  data-limit="{{ section.settings.max_products | default: 8 }}"
  data-intent="{{ section.settings.recommendation_type | default: 'related' }}"
  style="
    {% render 'spacing-style', settings: section.settings %}
    --csh-gap-pc: {{ section.settings.gap_pc | default: 16 }}px;
    --csh-gap-sp: {{ section.settings.gap_sp | default: 12 }}px;
    --csh-safe: var(--full-page-grid-margin-inline-offset, var(--page-margin-inline-offset, 16px));
    --csh-accent: {{ section.settings.accent_color | default: '#E63946' }};
    padding-block-start: {{ section.settings['padding-block-start'] | default: 36 }}px;
    padding-block-end:   {{ section.settings['padding-block-end']   | default: 36 }}px;
    {% if section.settings.bg_color != blank %}background: {{ section.settings.bg_color }};{% endif %}
  "
>
  {% if coll %}
    <div class="csh-head">
      <h2 class="csh-title">
        {%- if coll.title != blank -%}
          {{ coll.title }}
        {%- else -%}
          おすすめ商品
        {%- endif -%}
      </h2>
      {%- comment -%} このセクションでは「もっと見る」は出さない {%- endcomment -%}
    </div>

    {% if coll.products_count > 0 %}
      <div class="csh-grid js-home-recos-grid">
        {% for product in coll.products %}
          {%- comment -%}
            display_start_at / display_end_at による表示ロック判定
          {%- endcomment -%}
          {% liquid
            assign display_locked = false
            assign display_start_raw = product.metafields.product.display_start_at
            assign display_end_raw = product.metafields.product.display_end_at

            if display_start_raw != blank or display_end_raw != blank
              assign now_ts = 'now' | date: '%s'

              if display_start_raw != blank
                assign start_ts = display_start_raw | date: '%s'
              endif

              if display_end_raw != blank
                assign end_ts = display_end_raw | date: '%s'
              endif

              if display_start_raw != blank and display_end_raw == blank
                # start のみ → その日時より前は NG
                if now_ts < start_ts
                  assign display_locked = true
                endif

              elsif display_start_raw == blank and display_end_raw != blank
                # end のみ → その日時より後は NG
                if now_ts > end_ts
                  assign display_locked = true
                endif

              elsif display_start_raw != blank and display_end_raw != blank
                # start & end → 期間外は NG（期間内のみ表示）
                if now_ts < start_ts or now_ts > end_ts
                  assign display_locked = true
                endif
              endif
            endif
          %}

          {%- comment -%}
            ▼ バッジ判定（汎用コレクションと同じ）
          {%- endcomment -%}

          {%- assign now_ts = 'now' | date: '%s' | plus: 0 -%}
          {%- assign new_days = section.settings.new_days | default: 14 | plus: 0 -%}
          {%- assign days_sec = new_days | times: 86400 -%}
          {%- assign cutoff_ts = now_ts | minus: days_sec -%}

          {%- assign pub_ts = 0 -%}
          {%- if product.published_at != blank -%}
            {%- assign pub_ts = product.published_at | date: '%s' | plus: 0 -%}
          {%- endif -%}
          {%- assign is_new_published = false -%}
          {%- if pub_ts != 0 and pub_ts > cutoff_ts -%}{%- assign is_new_published = true -%}{%- endif -%}

          {%- assign tags_lc = product.tags | join: ',' | downcase -%}
          {%- assign tags_wrap = ',' | append: tags_lc | append: ',' -%}
          {%- assign is_new_tag = false -%}
          {%- if tags_wrap contains ',new,' -%}{%- assign is_new_tag = true -%}{%- endif -%}

          {%- assign is_new_mf = false -%}
          {%- if product.metafields.custom.new_until != blank -%}
            {%- assign new_until_ts = product.metafields.custom.new_until | date: '%s' | plus: 0 -%}
            {%- if new_until_ts > now_ts -%}{%- assign is_new_mf = true -%}{%- endif -%}
          {%- endif -%}

          {%- assign is_new = false -%}
          {%- if is_new_published or is_new_tag or is_new_mf -%}{%- assign is_new = true -%}{%- endif -%}

          {%- assign t_suffix = product.template_suffix | downcase | default: '' -%}

          {%- assign pre_ok = false -%}
          {%- if t_suffix contains 'preorder'
            or tags_wrap contains ',preorder,'
            or tags_wrap contains ',pre-order,'
            or tags_wrap contains ',pre order,'
            or tags_lc contains '予約'
            or tags_lc contains '先行'
            or tags_lc contains '先行予約'
            or product.metafields.custom.preorder
          -%}
            {%- assign pre_ok = true -%}
          {%- endif -%}

          {%- assign first_bonus_total = 0 -%}
          {%- assign first_bonus_low = false -%}
          {%- assign early_bonus = false -%}
          {%- assign closing_soon = false -%}

          {%- assign first_bonus_threshold = 10 | plus: 0 -%}
          {%- assign ten_days_sec = 864000 | plus: 0 -%}
          {%- assign min_end_ts = 0 -%}

          {%- for v in product.variants -%}
            {%- assign v_inventory = v.inventory_quantity | default: 0 | plus: 0 -%}
            {%- assign v_is_first_bonus = v.metafields.custom.is_first_bonus.value -%}
            {%- assign v_is_early_bonus = v.metafields.custom.is_early_bonus.value -%}

            {%- if v_is_first_bonus and v_inventory > 0 -%}
              {%- assign first_bonus_total = first_bonus_total | plus: v_inventory -%}
            {%- endif -%}

            {%- if pre_ok and v_is_early_bonus -%}
              {%- assign early_bonus = true -%}
            {%- endif -%}

            {%- assign v_end_raw = v.metafields.variant.sell_end_at -%}
            {%- if v_end_raw != blank -%}
              {%- assign v_end_ts = v_end_raw | date: '%s' | plus: 0 -%}
              {%- if min_end_ts == 0 or v_end_ts < min_end_ts -%}
                {%- assign min_end_ts = v_end_ts -%}
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}

          {%- if first_bonus_total > 0 and first_bonus_total <= first_bonus_threshold -%}
            {%- assign first_bonus_low = true -%}
          {%- endif -%}

          {%- if min_end_ts != 0 -%}
            {%- assign closing_from_ts = min_end_ts | minus: ten_days_sec -%}
            {%- if now_ts >= closing_from_ts and now_ts <= min_end_ts -%}
              {%- assign closing_soon = true -%}
            {%- endif -%}
          {%- endif -%}

          {%- comment -%}
            ▼ JS 用の初期データ（handle ごとのマップに入れる）
          {%- endcomment -%}
          {% capture pair %}
            {{ product.handle | json }}: {
              "display_locked": {{ display_locked | json }},
              "is_new": {{ is_new | json }},
              "pre_ok": {{ pre_ok | json }},
              "first_bonus_total": {{ first_bonus_total | json }},
              "early_bonus": {{ early_bonus | json }},
              "closing_soon": {{ closing_soon | json }},
              "template_suffix": {{ product.template_suffix | default: '' | json }}
            }
          {% endcapture %}
          {% if forloop.first %}
            {% assign initial_pairs = pair %}
          {% else %}
            {% assign initial_pairs = initial_pairs | append: ',' | append: pair %}
          {% endif %}

          {%- comment -%}
            ▼ 実際に表示するカードは max_products 件まで
          {%- endcomment -%}
          {% if forloop.index <= section.settings.max_products %}
            <a
              class="csh-card{% if display_locked %} csh-card--locked{% endif %}"
              {% unless display_locked %}
                href="{{ product.url | within: coll }}"
              {% endunless %}
            >
              <div class="csh-thumb">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 700 | image_tag: loading: 'lazy', alt: product.title }}
                {% endif %}
              </div>

              {% if section.settings.show_badges %}
                <div class="csh-badges csh-badges--below">
                  {%- if is_new and pre_ok == false -%}
                    <span class="csh-badge csh-badge--new">NEW</span>
                  {%- endif -%}

                  {%- if pre_ok -%}
                    <span class="csh-badge csh-badge--pre">予約受付中</span>
                  {%- endif -%}

                  {%- if first_bonus_low -%}
                    <span class="csh-badge csh-badge--first-bonus">初回特典残りわずか</span>
                  {%- endif -%}

                  {%- if early_bonus -%}
                    <span class="csh-badge csh-badge--early">早期予約特典あり</span>
                  {%- endif -%}

                  {%- if closing_soon -%}
                    <span class="csh-badge csh-badge--closing">締切間近</span>
                  {%- endif -%}
                </div>
              {% endif %}

              <div class="csh-body">
                <div class="csh-name">{{ product.title }}</div>
                {% if section.settings.show_price %}
                  <div class="csh-price">
                    {% if product.price_varies %}
                      {{ product.price_min | money }} — {{ product.price_max | money }}
                    {% else %}
                      {{ product.price | money }}
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            </a>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <p class="csh-empty">このコレクションに商品がありません。</p>
    {% endif %}
  {% else %}
    <p class="csh-empty">セクション設定でコレクションを選択してください。</p>
  {% endif %}

  {% capture initial_ex_json %}
    { {% if initial_pairs != blank %}{{ initial_pairs }}{% endif %} }
  {% endcapture %}

  <style>
    /* ===== 見出し行 ===== */
    #csh-{{ section.id }} .csh-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; margin-bottom:16px;
    }
    #csh-{{ section.id }} .csh-title{
      position:relative; margin:0; font-size:18px; font-weight:700; padding-left:14px;
    }
    #csh-{{ section.id }} .csh-title::before{
      content:""; position:absolute; left:0; top:0; width:3px; height:1.1em;
      background: var(--csh-accent, #e63946); border-radius:2px;
    }

    /* ===== グリッド ===== */
    #csh-{{ section.id }} .csh-grid{
      display:grid;
      grid-template-columns: repeat({{ section.settings.columns_desktop | default: 6 }}, minmax(0,1fr));
      gap: var(--csh-gap-pc);
    }

    /* ===== カード ===== */
    #csh-{{ section.id }} .csh-card{
      display:flex; flex-direction:column;
      color:inherit; text-decoration:none;
    }

    /* ===== サムネイル ===== */
    #csh-{{ section.id }} .csh-thumb{
      border-radius:5px; overflow:hidden; background:#0b0f14;
    }
    #csh-{{ section.id }} .csh-thumb img{
      width:100%; height:auto; display:block; border-radius:5px;
    }
    #csh-{{ section.id }} .csh-thumb::before{ content:none !important; }

    /* バッジ（画像の下） */
    #csh-{{ section.id }} .csh-badges--below{
      display:flex; gap:6px; margin-top:8px;
    }
    #csh-{{ section.id }} .csh-badge{
      font-size:10px; font-weight:700; line-height:1;
      padding:6px 8px; color:#fff;
      box-shadow:0 1px 2px rgba(0,0,0,.15);
    }
    #csh-{{ section.id }} .csh-badge--new{  background:#e63946; }
    #csh-{{ section.id }} .csh-badge--pre{  background:#3B82F6; color:#fff; border-radius:0; }
    #csh-{{ section.id }} .csh-badge--first-bonus{ background:#ef4444; }
    #csh-{{ section.id }} .csh-badge--early{        background:#22c55e; }
    #csh-{{ section.id }} .csh-badge--closing{      background:#f97316; }

    #csh-{{ section.id }} .csh-body{
      padding:10px 12px 10px 0; display:grid; gap:6px;
    }
    #csh-{{ section.id }} .csh-name{
      font-size:13px; line-height:1.4;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
      overflow:hidden;
    }
    #csh-{{ section.id }} .csh-price{ font-size:12px; opacity:.9; }

    /* バッジ折り返し制御 */
    #csh-{{ section.id }} .csh-badges.csh-badges--below{
      display:flex !important;
      flex-wrap:wrap !important;
      gap:6px 6px;
    }
    #csh-{{ section.id }} .csh-badges.csh-badges--below .csh-badge{
      display:inline-flex !important;
      align-items:center;
      white-space:nowrap !important;
      min-width:max-content;
    }

    /* ===== SP ===== */
    @media (max-width:768px){
      #csh-{{ section.id }}{ position:relative; }
      #csh-{{ section.id }} .csh-grid{
        display:flex !important; gap: var(--csh-gap-sp);
        overflow-x:auto; overflow-y:visible; -webkit-overflow-scrolling:touch;
        scroll-snap-type:x proximity; scroll-snap-stop:normal; scrollbar-gutter:stable;
        width: calc(100vw - var(--csh-safe));
        margin-right: calc(50% - 50vw - var(--csh-gap-sp));
        padding-bottom: 0px;
      }
      #csh-{{ section.id }} .csh-card{
        flex:0 0 clamp(140px, 38vw, 240px);
        width: clamp(140px, 38vw, 240px);
        scroll-snap-align:start;
      }
      #csh-{{ section.id }} .csh-grid::after{
        content:"";
        flex: 0 0 calc(max(0px, var(--csh-safe) - var(--csh-gap-sp)));
      }
    }

    /* display_start_at / display_end_at でロックされたカード */
    #csh-{{ section.id }} .csh-card.csh-card--locked{
      opacity:0.4;
      pointer-events:none;
      cursor:default;
    }
  </style>

  <script>
    (function(){
      console.log('[home recos] init');

      var sec  = document.getElementById('csh-{{ section.id }}');
      if (!sec) return;
      var grid = sec.querySelector('.js-home-recos-grid');
      if (!grid) return;

      var LIMIT      = Number(sec.dataset.limit || {{ section.settings.max_products | default: 8 }});
      var INTENT     = (sec.dataset.intent || '{{ section.settings.recommendation_type | default: "related" }}');
      var SHOW_PRICE = {{ section.settings.show_price | json }};
      var moneyFormat = {{ shop.money_format | json }};

      var initialEx = {{ initial_ex_json }} || {};

      function formatMoney(cents){
        if (!SHOW_PRICE) return '';
        if (window.Shopify && Shopify.formatMoney){
          return Shopify.formatMoney(cents, moneyFormat);
        }
        try{
          return (cents/100).toLocaleString('ja-JP', {
            style:'currency',
            currency:'JPY',
            minimumFractionDigits:0,
            maximumFractionDigits:0
          });
        }catch(e){
          return '¥' + Math.round(cents/100);
        }
      }

      function toCents(x){
        if (x == null) return null;
        if (typeof x === 'number' && Number.isFinite(x)) return Math.round(x);
        if (typeof x === 'string'){
          var s = x.replace(/[^\d.]/g,'').trim();
          if (!s) return null;
          var f = parseFloat(s);
          return Number.isFinite(f) ? Math.round(f*100) : null;
        }
        return null;
      }

      function priceHTMLFromProduct(p){
        if (!SHOW_PRICE) return '';
        var oneC = toCents(p.price != null ? p.price : (p.price_min != null ? p.price_min : (p.variants && p.variants[0] && p.variants[0].price)));
        var minC = toCents(p.price_min);
        var maxC = toCents(p.price_max);

        if (p.price_varies && minC != null && maxC != null) return formatMoney(minC) + ' — ' + formatMoney(maxC);
        if (oneC != null) return formatMoney(oneC);
        if (minC != null) return formatMoney(minC);
        return '';
      }

      function productHref(p){
        var base = {{ routes.root_url | json }};
        if (p && p.url) return p.url;
        if (p && p.online_store_url) return p.online_store_url;
        if (p && p.handle) return base + 'products/' + p.handle;
        return '#';
      }

      function primaryImage(p){
        if (p && p.featured_image) return p.featured_image;
        if (p && p.images && p.images[0]){
          return p.images[0].src || p.images[0].url || null;
        }
        return null;
      }

      /* recentlyViewedEx から display_locked 等を拾う */
      var exMap = {};
      try{
        var exArr = JSON.parse(localStorage.getItem('recentlyViewedEx')) || [];
        if (Array.isArray(exArr)){
          exArr.forEach(function(item){
            if (!item || !item.handle) return;
            exMap[item.handle] = item;
          });
        }
      }catch(e){
        console.warn('[home recos] exMap error', e);
      }

      function normalize(p){
        var handle = p.handle || null;
        var init   = handle && initialEx[handle] ? initialEx[handle] : {};
        var ex     = handle && exMap[handle] ? exMap[handle] : init;

        return {
          id: p.id,
          title: p.title,
          handle: handle,
          url: p.url || p.online_store_url || null,
          online_store_url: p.online_store_url || null,
          featured_image: primaryImage(p),
          price: p.price,
          price_min: p.price_min,
          price_max: p.price_max,
          price_varies: p.price_varies,
          variants: p.variants || null,
          display_locked: !!(p.display_locked || ex.display_locked),
          template_suffix: (p.template_suffix || ex.template_suffix || ''),
          is_new: !!ex.is_new,
          pre_ok: !!ex.pre_ok,
          first_bonus_total: ex.first_bonus_total || 0,
          early_bonus: !!ex.early_bonus,
          closing_soon: !!ex.closing_soon
        };
      }

      function keyOf(p){
        return p.id || p.handle || p.url || (p.title + ':' + (p.price || ''));
      }

      function dedupe(list){
        var s = new Set();
        return list.filter(function(p){
          var k = keyOf(p);
          if (s.has(k)) return false;
          s.add(k);
          return true;
        });
      }

      function render(list){
        console.log('[home recos] render', list.length);
        var html = '';
        list.slice(0, LIMIT).forEach(function(p){
          var img       = primaryImage(p);
          var priceHtml = priceHTMLFromProduct(p);
          var locked    = !!p.display_locked;
          var href      = locked ? 'javascript:void(0)' : productHref(p);
          var lockedCls = locked ? ' csh-card--locked' : '';
          var lockedAttr= locked ? ' aria-disabled="true"' : '';

          var badges = '';
          var is_new = p.is_new;
          var pre_ok = p.pre_ok;
          var first_low = p.first_bonus_total && p.first_bonus_total > 0 && p.first_bonus_total <= 10;
          var early = p.early_bonus;
          var closing = p.closing_soon;

          if (is_new || pre_ok || first_low || early || closing){
            badges += '<div class="csh-badges csh-badges--below">';
            if (is_new && !pre_ok){
              badges += '<span class="csh-badge csh-badge--new">NEW</span>';
            }
            if (pre_ok){
              badges += '<span class="csh-badge csh-badge--pre">予約受付中</span>';
            }
            if (first_low){
              badges += '<span class="csh-badge csh-badge--first-bonus">初回特典残りわずか</span>';
            }
            if (early){
              badges += '<span class="csh-badge csh-badge--early">早期予約特典あり</span>';
            }
            if (closing){
              badges += '<span class="csh-badge csh-badge--closing">締切間近</span>';
            }
            badges += '</div>';
          }

          html += '<a class="csh-card' + lockedCls + '" href="' + href + '"' + lockedAttr + '>';
          html +=   '<div class="csh-thumb">';
          if (img){
            html += '<img src="' + img + '&width=700" alt="' + (p.title || '') + '" loading="lazy">';
          }
          html +=   '</div>';
          html +=   badges;
          html +=   '<div class="csh-body">';
          html +=     '<div class="csh-name">' + (p.title || '') + '</div>';
          if (priceHtml){
            html +=   '<div class="csh-price">' + priceHtml + '</div>';
          }
          html +=   '</div>';
          html += '</a>';
        });
        grid.innerHTML = html;
      }

      async function fetchRecommendations(pid){
        var url = "{{ routes.product_recommendations_url }}.json"
                  + "?product_id=" + encodeURIComponent(pid)
                  + "&intent=" + encodeURIComponent(INTENT)
                  + "&limit=" + encodeURIComponent(LIMIT);
        var r = await fetch(url, {credentials:'same-origin'});
        if (!r.ok) throw new Error('recos failed');
        var data = await r.json();
        console.log('[home recos] recos raw', data);
        return Array.isArray(data.products) ? data.products.map(normalize) : [];
      }

      async function fetchCollection(handle, take){
        if (!handle) return [];
        var r = await fetch('/collections/' + encodeURIComponent(handle) + '/products.json?limit=' + encodeURIComponent(take), {credentials:'same-origin'});
        if (!r.ok) throw new Error('collection failed');
        var json = await r.json();
        var products = json.products || [];
        return products.map(normalize);
      }

      async function run(){
        var lastPid = null;
        try{
          lastPid = localStorage.getItem('wb_last_pid');
        }catch(e){
          console.warn('[home recos] wb_last_pid error', e);
        }

        console.log('[home recos] lastPid=', lastPid);

        if (!lastPid){
          // 初回は Liquid の描画そのまま（コレクション表示）
          return;
        }

        try{
          var recos = await fetchRecommendations(lastPid);
          recos = dedupe(recos);

          // 足りない分は fallback コレクションから補充
          if (recos.length < LIMIT && {{ coll | json }}){
            var fbHandle = {{ coll.handle | json }};
            if (fbHandle){
              var pool = await fetchCollection(fbHandle, LIMIT * 3);
              var keys = new Set(recos.map(keyOf));
              pool.forEach(function(p){
                var k = keyOf(p);
                if (keys.has(k)) return;
                recos.push(p);
                keys.add(k);
              });
            }
          }

          if (!recos.length){
            // 0件ならコレクション表示のまま
            return;
          }

          // 見出し差し替え
          var titleEl = sec.querySelector('.csh-title');
          if (titleEl){
            titleEl.textContent = {{ section.settings.title_personal | json }};
          }

          render(recos);
        }catch(e){
          console.warn('[home recos] error', e);
        }
      }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', run, {once:true});
      }else{
        run();
      }
    })();
  </script>
</section>

{% schema %}
{
  "name": "あなたへのおすすめ（Custom）",
  "settings": [
    {
      "type": "text",
      "id": "title_personal",
      "label": "回遊後の見出し（差し替え時）",
      "default": "あなたへのおすすめ"
    },

    {
      "type": "collection",
      "id": "fallback_collection",
      "label": "初回に表示するおすすめコレクション",
      "info": "初回訪問時に表示する商品コレクション。"
    },

    {
      "type": "select",
      "id": "recommendation_type",
      "label": "おすすめ種別（回遊後）",
      "options": [
        { "value": "related", "label": "関連商品" },
        { "value": "complementary", "label": "一緒に購入されやすい" }
      ],
      "default": "related"
    },

    { "type": "range", "id": "max_products", "label": "最大表示数", "min": 3, "max": 12, "step": 1, "default": 8 },
    { "type": "checkbox", "id": "show_price", "label": "価格を表示", "default": true },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "商品ラベル（初回表示時のみ Liquid 側で制御）",
      "default": true
    },
    {
      "type": "range",
      "id": "new_days",
      "label": "NEW判定（日数以内の公開）",
      "min": 1,
      "max": 60,
      "step": 1,
      "default": 14
    },

    { "type": "header", "content": "レイアウト" },
    { "type": "range", "id": "columns_desktop", "label": "（PC）列数", "min": 2, "max": 8, "step": 1, "default": 6 },
    { "type": "range", "id": "gap_pc", "label": "（PC）カード間隔(px)", "min": 8, "max": 32, "step": 2, "default": 16 },
    { "type": "range", "id": "gap_sp", "label": "（SP）カード間隔(px)", "min": 6, "max": 24, "step": 1, "default": 12 },

    { "type": "header", "content": "余白 / 背景" },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "上余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "下余白",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    { "type": "color", "id": "bg_color", "label": "背景色", "default": "#F5F6F9" },

    { "type": "color_scheme", "id": "color_scheme", "label": "配色（Horizonのスキーム）", "default": "scheme-1" },
    { "type": "color", "id": "accent_color", "label": "アクセントカラー（左線／丸アイコン）", "default": "#E63946" }
  ],
  "presets": [{ "name": "あなたへのおすすめ（Custom）" }]
}
{% endschema %}
